<!DOCTYPE html>
<html lang="en">

<head>
    <title>Network Penetration Testing Tool</title>
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
            <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
        </symbol>
        <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
            <path
                d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
        </symbol>
        <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
            <path
                d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
        </symbol>
    </svg>
    <style>
        .yellow-row {
            background-color: rgb(255, 243, 205);
        }
    </style>
    <script>
        function printFunction() {
            window.print();
        }
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function logoutFunction() {
            document.cookie = "session_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            window.location.href = "./";
        }
    </script>
    
</head>



<body>
    <!-- Bootstrap 5 Navbars -->
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="home">Network Penetration Testing Tool</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Scanner</a>
                    </li>                    
                    <li class="nav-item">
                        <a class="nav-link" href="summary">Summary</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="whitelist">Whitelist</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="help">Help</a>
                    </li>
                </ul>
                <!-- ============================= -->
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="logoutFunction()">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Start -->
    <div class="container mt-5">
        <h1>2. Scanner Result</h1>
        <div class="remind-bar"></div>
        <div class="remind-bar2"></div>
        <div class="container p-5 my-5 border">
            <form>
                <div class="form-group">
                    <div class="container">
                        <div class="col">
                            <div class="progress">
                                <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated"
                                    role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"
                                    style=width:1%></div>
                            </div>
                            <br>
                            <button type="button" name="back-to-scanner" onclick="location.href='/scanner'" class="btn btn-secondary" data-bs-dismiss="modal" style="float: left;">Back to scanner</button>
                            <br>
                            <br>
                            <br>
                            <table id="scanresult" class="table table-hover table-bordered border-primary">
                                <thead>
                                    <tr>
                                        <th scope="col">ScanID</th>
                                        <th scope="col">IPv4</th>
                                        <th scope="col">OS</th>
                                        <th scope="col">Manufacturer</th>
                                        <th scope="col">Mac Address</th>
                                        <th scope="col">Open port</th>
                                        <th scope="col">More Information</th>
                                    </tr>
                                </thead>

                                <tbody>

                                </tbody>
                            </table>
                            <button type="button" name="back-to-scanner" onclick="location.href='/scanner'" class="btn btn-secondary" data-bs-dismiss="modal" style="float: left;">Back to scanner</button>
                            <br>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="modal fade" id="moreinfo" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="more">More Information</h5>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <div class="container">
                            <div class="row">
                                <div class="col">
                                    <h6><u>Host Info</u></h6>
                                </div>
                                <div class="col">
                                    <h6><u>OS Info</u></h6>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                                <div class="col-3">
                                    <small></small>
                                </div>
                            </div>
                            <br>
                            <div class='script_data'></div>
                            <div class='services-version'></div>
                            <div class="scan-services-version"></div>
                    </div>
                    <br>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        // Call the updateTable function every 2 seconds
        setInterval(fetchData, 2000);
    });
    let global_data;
    function port_sorting(portList) {
        if (!portList) return ''; // handle case where portList is null or undefined
        var ports = portList.split(',');
        ports.sort(function(a, b) {
            return parseInt(a) - parseInt(b);
            });
            return ports.join(',')
    }
    function fetchData() {
        $.ajax({
            url: './get_progress',
            type: 'GET',
            dataType: 'json',
            success: function (data) {                
                global_data = data;
                let tableBody = $('#scanresult tbody');
                tableBody.empty(); // Clear existing table rows
                //console.log('Updating Progress...', data);

                if (!Array.isArray(data)) {
                    console.log('Error: Data is not an array.');
                    return;
                }

                data.forEach(function (item) {
                    //console.log(item[12]);
                    if (item[12] == "TRUE") {
                        let row = `<tr>
                                    <td>${item[0]}</td>
                                    <td>${item[1]}</td>
                                    <td>${item[7]}</td>
                                    <td>${item[5]}</td>
                                    <td>${item[3]}</td>
                                    <td>${port_sorting(item[2])}</td>
                                    <td style="text-align: center">
                                        <button type="button" class="btn btn-primary more-btn" data-bs-toggle="modal" data-bs-target="#moreinfo" data-item-index="${item[0]}">
                                            More
                                        </button>
                                    </td>
                                </tr>`;
                        tableBody.append(row);
                    } else {
                        let row = `<tr class="yellow-row">
                                    <td>${item[0]}</td>
                                    <td>${item[1]}</td>
                                    <td>${item[7]}</td>
                                    <td>${item[5]}</td>
                                    <td>${item[3]}</td>
                                    <td>${port_sorting(item[2])}</td>
                                    <td style="text-align: center">
                                        <button type="button" class="btn btn-primary more-btn" data-bs-toggle="modal" data-bs-target="#moreinfo" data-item-index="${item[0]}">
                                            More
                                        </button>
                                    </td>
                                </tr>`;
                        tableBody.append(row);
                        var remindBar = document.querySelector('.remind-bar2');
                        remindBar.innerHTML = '<div class="alert alert-warning d-flex align-items-center" role="alert"><svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Warning:"><use xlink:href="#exclamation-triangle-fill"/></svg><div><strong>Yellow: Device not in the whitelist!</strong></div></div>';
                    }

                    $('#progress-bar').css('width', `${item[13]}%`);
                    $('#progress-bar').html(`${item[13]}%`);
                    if (item[13] == "100") {
                        $('#progress-bar').css('width', '100%'); // set progress to 100%
                        $('#progress-bar').removeClass('progress-bar-animated progress-bar-striped'); // remove the animation and stripes classes
                        $('#progress-bar').addClass('bg-success'); // add the success class to change the color
                        $('#progress-bar').html(`Scanning completed!`);
                    }


                });

            },
            error: function (error) {
                console.log('Error:', error);
            }
        });

        
        $(document).on('click', '.more-btn', function () {           
            
            let index = parseInt($(this).data('item-index'));
            let item = global_data[index - 1];

            // Update modal content using item data
            let modal = $('#moreinfo');

            modal.find('.modal-title').text('More Information');
            modal.find('.modal-body .row:eq(1) .col-3:eq(0) small').text('IPv4: ');
            modal.find('.modal-body .row:eq(1) .col-3:eq(1) small').text(item[1]);

            modal.find('.modal-body .row:eq(2) .col-3:eq(0) small').text('Mac Address: ');
            modal.find('.modal-body .row:eq(2) .col-3:eq(1) small').text(item[3]);

            modal.find('.modal-body .row:eq(3) .col-3:eq(0) small').text('Host Name: ');
            modal.find('.modal-body .row:eq(3) .col-3:eq(1) small').text(item[4]);

            modal.find('.modal-body .row:eq(4) .col-3:eq(0) small').text('Vendor: ');
            modal.find('.modal-body .row:eq(4) .col-3:eq(1) small').text(item[5]);

            modal.find('.modal-body .row:eq(5) .col-3:eq(0) small').text('Uptime: ');
            modal.find('.modal-body .row:eq(5) .col-3:eq(1) small').text(item[6]);

            modal.find('.modal-body .row:eq(1) .col-3:eq(2) small').text('OS Name: ');
            modal.find('.modal-body .row:eq(1) .col-3:eq(3) small').text(item[7]);

            modal.find('.modal-body .row:eq(2) .col-3:eq(2) small').text('OS Vendor: ');
            modal.find('.modal-body .row:eq(2) .col-3:eq(3) small').text(item[8]);

            modal.find('.modal-body .row:eq(3) .col-3:eq(2) small').text('OS Family: ');
            modal.find('.modal-body .row:eq(3) .col-3:eq(3) small').text(item[9]);

            modal.find('.modal-body .row:eq(4) .col-3:eq(2) small').text('OS Gen: ');
            modal.find('.modal-body .row:eq(4) .col-3:eq(3) small').text(item[10]);
            
            modal.find('.modal-body .row:eq(5) .col-3:eq(2) small').text('OS Accuracy: ');
            modal.find('.modal-body .row:eq(5) .col-3:eq(3) small').text(item[11]);
            
            



            var services_version = document.querySelector('.scan-services-version');
            $(".scan-services-version").each(function() {
                $(this).empty();
            });
            if (item[2] != null) {
                let buttons = '';
                const button = `<form method="POST"><button type="submit" name="services" class="btn btn-primary" data-bs-dismiss="modal"><input name="ip" id="ip" value="${item[1]}" type="hidden"></input><input name="scan_id" id="scan_id" value="${item[0]}" type="hidden"></input><input name="port" id="port" value="${port_sorting(item[2])}" type="hidden"></input>Scan services version</button></form><br>`;
                buttons += button;
                modal.find('.modal-body .scan-services-version').html(buttons);
            }            

        });

    }

    function fetchDataScript() {
        $.ajax({
            url: './get_script_data',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                data = data["data"];
                global_datas = data;                
            }
        });        

        $(document).on('click', '.more-btn', function () {           
            let index = parseInt($(this).data('item-index'));
            var script_data = document.querySelector('.script_data');
            $(".script_data").each(function() {
                $(this).empty();
            });

            let print_tag = false;

            for (let i = 0; i < global_datas.length; i++) {
               
                if (global_datas[i].scan_id == index){
                    if (print_tag == false) {
                        script_data.innerHTML = '<div class="row"><div class="col"><h6><u>Script ID</u></h6></div><div class="col"><h6><u>Output</u></h6></div></div>';
                        print_tag = true;
                    }
                    script_data.innerHTML += `<div class="row"><div class="col">${global_datas[i].script_name}</div><div class="col">${global_datas[i].script_output}</div></div>`;
                }
                
            };

            
            
        });
    }

</script>